---
title: "figureindex"
author: "NDS"
date: "March 26, 2015"
output: html_document
---

To illustrate the behavior of LDA index, we use Huber's plot(1990). 
In one-dimensional projections from 2-dimensionalspace, for $\theta= 0^o,\ldots,179^o$,
the projection pursuit index is calculated using projection $a_{\theta} = (cos(\theta), sin(\theta))$ and displayed radially as a function of $\theta$.

```{r,echo=FALSE,warning=FALSE,message=FALSE}
library(plyr)
library(MASS)
library(ggplot2)
library(rrcov)
```

Function for within group and between sums of squares:
```{r}
f <- function(d) {
  names(d)[1]<-"Class"
  xb <- apply(d[,-1],2,mean)
  xbi <- ddply(d, .(Class), function(x) {apply(x[,-1],2,mean)} )
  n <-table(d[,1])
  sbw <- matrix(0,ncol=ncol(d)-1,nrow=ncol(d)-1)
  for(i in 1:length(n)){
    aux <- as.matrix(xbi[i,-1]-xb)
    sbw<-(t(aux)%*%aux)*n[i]+sbw
    }
  wi <- daply(d,.(Class),function(x) var(x[,-1])*(length(x[,1])-1))
  
  swi <- apply(wi,c(2,3),sum)
  list(swi,sbw)  
  }

```
Simultate bivariate Normal distributions with the same variance,

$\Sigma=\left( \begin{array}{cc}
1 & 0.95  \\
0.95 & 1  \\ \end{array} \right)$

$\mu_1=\left( \begin{array}{c}
-1   \\
0.6 \\ \end{array} \right) \;\;\;\mbox{and}\;\;\;
\mu_2=\left( \begin{array}{c}
1   \\
0.6 \\ \end{array} \right)$





```{r}
bivn <- mvrnorm(50, mu = c(-1, 0.6), Sigma = matrix(c(1, 0.95, 0.95, 1), 2))
bivn2 <- mvrnorm(50, mu = c(1, -0.6), Sigma = matrix(c(1, 0.95, 0.95, 1), 2))

d1 <-data.frame(Sim="sim1",bivn)
d2 <-data.frame(Sim="sim2",bivn2)
dat.sim <- rbind(d1,d2)


```

```{r,fig.show='hold',fig.width = 6 ,fig.height = 4 }
ggplot(data=dat.sim,aes(x=X1,y=X2))+geom_point(aes(shape=Sim))+
  scale_y_continuous(limits=c(-5,5)) + scale_x_continuous(limits=c(-5,5))

```

LDA Index, two ways to compute 
```{r}
#projection vector evaluated in radianes
theta <- 0:179
a <- data.frame(a1=cos(theta*pi/180),a2=sin(theta*pi/180))
res <- f(dat.sim)
swi <- res[[1]]
sbw <- res[[2]]

#LDA index is computed using the projection vectors in radianes
ilda <-apply(a,1,function(x){
  x <- matrix(x,nrow=2)
  1- (t(x)%*%swi%*%x)/(t(x)%*%(swi+sbw)%*%x) 
  
  }
  )

ilda.aov <- function(theta){
dattr <- data.frame(Sim=dat.sim$Sim,X1=dat.sim[,2]*cos(theta*pi/180),X2=sin(theta*pi/180)*dat.sim[,3])
dattr$suma <- dattr$X1+dattr$X2
anova(lm(suma~Sim,data=dattr))[[2]][[1]]/sum(anova(lm(suma~Sim,data=dattr))[[2]])
}

ilda.rm <- mdply(data.frame(theta=0:179),ilda.aov)
```

I got the same result with the two ways to compute ILDA :-)
```{r,fig.show='hold',fig.width = 6 ,fig.height = 4 }
wmi <-which.min(ilda)-1
wma <- which.max(ilda)-1

ggplot(data=dat.sim,aes(x=X1,y=X2))+geom_point(aes(shape=Sim))+
  scale_y_continuous(limits=c(-5,5)) + scale_x_continuous(limits=c(-5,5))+ 
  geom_abline(intercept=0,slope=sin(wma*pi/180)/cos(wma*pi/180))+
  geom_abline(intercept=0,slope=sin(wmi*pi/180)/cos(wmi*pi/180))
  

```
Plot the LDA index vs $\theta$ values, maximun value is in $\theta=136$\\

\begin{figure}
```{r,fig.show='hold',fig.width = 6 ,fig.height = 4,echo=FALSE }
dat.pl<-data.frame(ilda=ilda,theta=theta)
aux<-which.max(ilda)-1
aux2<-which.min(ilda)-1
ggplot(data=dat.pl,aes(x=theta, y= ilda) )+geom_line()+geom_vline(xintercept=aux,colour=I("red")) +
  geom_hline(yintercept=ilda[[1]],linetype="dashed")
```
\end{figure}

Plot only  $\theta=0:179$ and the other part is symmetric\\


```{r,fig.show='hold',fig.width = 6 ,fig.height = 4,echo=FALSE }

df <- data.frame(x=cos(theta*pi/180)*median(ilda),y=sin(theta*pi/180)*median(ilda))
df2 <- data.frame(x=cos(theta*pi/180)*ilda,y=sin(theta*pi/180)*ilda)

ggplot(data=df2,aes(x=x,y=y))+geom_point() 

```
Plot all and also the reference line base in the mean(ilda)\\

```{r,fig.show='hold',fig.width = 6 ,fig.height = 4,echo=FALSE }

p1 <- ggplot(df)  + geom_line(aes(x=x,y=y))+geom_line(aes(x=-x,y=-y)) 
p1 + geom_point(data=df2,aes(x=x,y=y)) + geom_point(data=df2,aes(x=-x,y=-y)) 
        


```